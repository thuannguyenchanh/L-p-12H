<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Bộ công cụ góc lượng giác — Interactive</title>
<style>
  :root{
    --bg:#f4f7ff;
    --card:#ffffff;
    --muted:#6b7280;
    --accent:#4563ff;
    --accent-2:#00a99d;
    --danger:#ff5c5c;
    --glass: rgba(255,255,255,0.85);
    --shadow: 0 6px 20px rgba(22, 28, 56, 0.08);
    --radius:14px;
    --mono: "Segoe UI", Roboto, "Helvetica Neue", Arial;
  }
  *{box-sizing:border-box}
  body{
    margin:0;
    font-family: var(--mono);
    background: linear-gradient(180deg, #eaf0ff 0%, var(--bg) 100%);
    color:#12233b;
    -webkit-font-smoothing:antialiased;
  }
  header{
    padding:20px 28px;
    display:flex;
    align-items:center;
    gap:18px;
  }
  header h1{
    margin:0;
    font-size:20px;
    color:var(--accent);
  }
  header p{ margin:0; color:var(--muted); font-size:13px }

  .wrap{
    max-width:1200px;
    margin:12px auto 60px;
    padding:18px;
    display:grid;
    grid-template-columns: 360px 1fr;
    gap:18px;
  }

  /* left controls column */
  .panel{
    background:var(--card);
    border-radius:var(--radius);
    padding:18px;
    box-shadow:var(--shadow);
    min-height:220px;
  }
  .group{ margin-bottom:12px }
  label{ display:block; font-size:13px; color:var(--muted); margin-bottom:6px }
  input[type="number"], input[type="text"], select {
    width:100%;
    padding:10px;
    border-radius:10px;
    border:1px solid #e2e6f0;
    font-size:14px;
  }
  .row{ display:flex; gap:10px; align-items:center }
  .row .half{ flex:1 }

  .small{ font-size:12px; color:var(--muted) }

  .controls{
    display:flex;
    gap:10px;
    margin-top:8px;
    align-items:center;
  }
  .btn{
    background:var(--accent);
    border:none;
    color:white;
    padding:9px 12px;
    border-radius:10px;
    cursor:pointer;
    font-weight:600;
  }
  .btn.secondary{ background:#f3f4f6; color:#222; border:1px solid #e6e9f5; }
  .btn.warn{ background:var(--danger); }

  /* right main area */
  .main{
    display:grid;
    grid-template-rows: auto 1fr;
    gap:12px;
  }

  .card{
    background:var(--card);
    border-radius:var(--radius);
    padding:14px;
    box-shadow:var(--shadow);
  }

  /* tabs */
  .tabs{
    display:flex;
    gap:8px;
    padding:6px;
  }
  .tab{
    padding:8px 12px;
    border-radius:10px;
    cursor:pointer;
    font-weight:600;
    color:var(--muted);
  }
  .tab.active{
    background:linear-gradient(90deg,var(--accent), #6b7cff);
    color:white;
    box-shadow: 0 6px 18px rgba(69,99,255,0.18);
  }

  /* canvas grid */
  .grid{
    display:grid;
    grid-template-columns: 1fr 340px;
    gap:12px;
    min-height:420px;
  }

  /* circle area */
  .canvas-wrap{
    display:flex;
    flex-direction:column;
    gap:10px;
    align-items:center;
    justify-content:center;
  }

  canvas { background:var(--glass); border-radius:12px; box-shadow:0 6px 18px rgba(0,0,0,0.04) }

  /* right side info */
  .info {
    display:flex;
    flex-direction:column;
    gap:10px;
  }
  .info .metric{
    background:linear-gradient(180deg,#fff,#fbfdff);
    border-radius:12px;
    padding:10px;
    border:1px solid #eef2ff;
  }
  .metric .title{ font-size:12px; color:var(--muted) }
  .metric .value{ font-size:20px; font-weight:700; color:#16203a }

  .bars{ display:flex; flex-direction:column; gap:8px; }
  .bar{
    display:flex;
    gap:8px;
    align-items:center;
  }
  .bar .label{ width:60px; font-size:13px; color:var(--muted) }
  .bar .track{ flex:1; height:10px; background:#eef3ff; border-radius:8px; overflow:hidden }
  .bar .track > i{ display:block; height:100%; background:linear-gradient(90deg,var(--accent), #76a6ff); border-radius:8px }

  .footer-controls{ display:flex; gap:8px; align-items:center; margin-top:8px; justify-content:space-between }
  .tiny{ font-size:12px; color:var(--muted) }

  /* responsive */
  @media (max-width:980px){
    .wrap{ grid-template-columns: 1fr; padding:12px }
    .grid{ grid-template-columns: 1fr; }
    canvas{ width:100% !important; height:360px !important; }
  }
</style>
</head>
<body>

<header>
  <div>
    <h1>Bộ công cụ góc lượng giác — Interactive</h1>
    <p class="small">3 phần: Góc ↔ Điểm trên đường tròn ↔ Giá trị lượng giác — có animation</p>
  </div>
</header>

<div class="wrap">

  <!-- LEFT: controls -->
  <div class="panel">
    <div style="display:flex; justify-content:space-between; align-items:center">
      <div>
        <div style="font-weight:700">Điều khiển góc</div>
        <div class="small">Nhập góc, chọn đơn vị, bật animation</div>
      </div>
      <div style="text-align:right">
        <div class="small">Normalized</div>
        <div id="normDisplay" style="font-weight:700">0°</div>
      </div>
    </div>

    <div class="group" style="margin-top:12px">
      <label>Góc (độ)</label>
      <div class="row">
        <input id="degInput" type="number" class="half" value="45" step="0.1" />
        <select id="angleUnit" style="width:110px; padding:10px; border-radius:10px;">
          <option value="deg">° (degree)</option>
          <option value="rad">rad</option>
        </select>
      </div>
      <div class="small" style="margin-top:6px">Bạn cũng có thể nhập radian nếu đổi unit sang <b>rad</b>.</div>
    </div>

    <div class="group">
      <label>Slider góc (độ)</label>
      <input id="angleRange" type="range" min="-1080" max="1080" value="45" style="width:100%" />
      <div class="row" style="margin-top:8px">
        <button id="playBtn" class="btn">Play ▶</button>
        <button id="pauseBtn" class="btn secondary">Pause ▮▮</button>
        <button id="zeroBtn" class="btn secondary">Đưa về 0°</button>
        <select id="speedSel" style="padding:8px; border-radius:8px;">
          <option value="0.5">0.5x</option>
          <option value="1" selected>1x</option>
          <option value="2">2x</option>
          <option value="4">4x</option>
        </select>
      </div>
    </div>

    <div class="group">
      <label>Hiển thị</label>
      <div style="display:flex; gap:8px; flex-wrap:wrap">
        <label><input type="checkbox" id="showAxes" checked /> Trục X/Y</label>
        <label><input type="checkbox" id="showCircle" checked /> Đường tròn</label>
        <label><input type="checkbox" id="showRadius" checked /> Bán kính OM</label>
        <label><input type="checkbox" id="showProjections" checked /> Dựng cos/sin</label>
        <label><input type="checkbox" id="showPoints" checked /> Điểm đặc biệt</label>
      </div>
    </div>

    <div class="group">
      <label>Options</label>
      <div style="display:flex; gap:8px; align-items:center;">
        <label class="small">Direction:</label>
        <select id="dir" style="padding:8px; border-radius:8px;">
          <option value="ccw">CCW (ngược kim)</option>
          <option value="cw">CW (kim đồng hồ)</option>
        </select>
      </div>
    </div>

    <div style="margin-top:10px; display:flex; justify-content:space-between; align-items:center">
      <div class="small">Phiên bản: Bản B — đầy đủ</div>
      <div class="tiny">Made with ❤️</div>
    </div>
  </div>

  <!-- RIGHT: main -->
  <div class="main">
    <div class="card">
      <div style="display:flex; justify-content:space-between; align-items:center">
        <div style="display:flex; gap:12px; align-items:center">
          <div class="tabs" id="tabs">
            <div class="tab active" data-tab="angle">Góc lượng giác</div>
            <div class="tab" data-tab="point">Điểm biểu diễn</div>
            <div class="tab" data-tab="values">Giá trị lượng giác</div>
          </div>
        </div>
        <div style="display:flex; gap:8px; align-items:center">
          <div class="small">Input dạng π?</div>
          <button id="piSample" class="btn secondary">Ví dụ: π/3</button>
        </div>
      </div>
    </div>

    <div class="card grid">
      <div class="canvas-wrap">
        <canvas id="unitCircle" width="720" height="540"></canvas>
        <div class="footer-controls" style="width:90%">
          <div>
            <span class="small">Góc hiện tại:</span>
            <strong id="angleLabel">45°</strong>
            <span class="small" style="margin-left:8px" id="radLabel">(0.785 rad)</span>
          </div>

          <div>
            <label class="small">Vòng: </label>
            <span id="turnsText" class="small">0</span>
          </div>
        </div>
      </div>

      <div class="info">
        <div class="metric">
          <div class="title">Giá trị lượng giác</div>
          <div style="display:flex; justify-content:space-between; align-items:center">
            <div>
              <div class="value" id="sinV">sin = 0.707</div>
              <div class="small">sin(α)</div>
            </div>
            <div>
              <div class="value" id="cosV">cos = 0.707</div>
              <div class="small">cos(α)</div>
            </div>
          </div>
        </div>

        <div class="metric">
          <div class="title">Tan / Cot</div>
          <div style="display:flex; justify-content:space-between; align-items:center">
            <div>
              <div class="value" id="tanV">tan = 1.000</div>
              <div class="small">tan(α)</div>
            </div>
            <div>
              <div class="value" id="cotV">cot = 1.000</div>
              <div class="small">cot(α)</div>
            </div>
          </div>
        </div>

        <div class="metric">
          <div class="title">Biểu diễn trực quan</div>
          <div class="bars">
            <div class="bar"><div class="label">sin</div><div class="track"><i id="barSin" style="width:70%"></i></div></div>
            <div class="bar"><div class="label">cos</div><div class="track"><i id="barCos" style="width:70%"></i></div></div>
            <div class="bar"><div class="label">|tan|</div><div class="track"><i id="barTan" style="width:40%"></i></div></div>
          </div>
        </div>

        <div class="metric" style="display:flex; gap:8px; align-items:center; justify-content:space-between">
          <div>
            <div class="title">Controls nhỏ</div>
            <div class="small">Bạn có thể nhập góc dạng 'π/3' nếu chọn unit = rad</div>
          </div>
          <div style="text-align:right">
            <div class="small">FPS: <span id="fps">60</span></div>
            <div class="small">Speed: <span id="speedText">1x</span></div>
          </div>
        </div>

      </div> <!-- info -->
    </div> <!-- grid -->
  </div> <!-- main -->

</div> <!-- wrap -->


<script>
/* =========================
   Utilities & app state
   ========================= */
const degInput = document.getElementById('degInput');
const angleUnit = document.getElementById('angleUnit');
const angleRange = document.getElementById('angleRange');
const playBtn = document.getElementById('playBtn');
const pauseBtn = document.getElementById('pauseBtn');
const zeroBtn = document.getElementById('zeroBtn');
const speedSel = document.getElementById('speedSel');
const dirSel = document.getElementById('dir');
const showAxes = document.getElementById('showAxes');
const showCircle = document.getElementById('showCircle');
const showRadius = document.getElementById('showRadius');
const showProjections = document.getElementById('showProjections');
const showPoints = document.getElementById('showPoints');
const angleLabel = document.getElementById('angleLabel');
const radLabel = document.getElementById('radLabel');
const normDisplay = document.getElementById('normDisplay');
const sinV = document.getElementById('sinV');
const cosV = document.getElementById('cosV');
const tanV = document.getElementById('tanV');
const cotV = document.getElementById('cotV');
const barSin = document.getElementById('barSin');
const barCos = document.getElementById('barCos');
const barTan = document.getElementById('barTan');
const turnsText = document.getElementById('turnsText');
const fpsLabel = document.getElementById('fps');
const speedText = document.getElementById('speedText');
const piSample = document.getElementById('piSample');

const canvas = document.getElementById('unitCircle');
const ctx = canvas.getContext('2d');

let state = {
  anim: false,
  angleDeg: parseFloat(degInput.value) || 0,
  speed: parseFloat(speedSel.value),
  dir: dirSel.value,
  lastTime: performance.now(),
  frameCount:0,
  fps:60,
  loops: 0
};

// tabs
document.querySelectorAll('.tab').forEach(t => t.addEventListener('click', (e)=>{
  document.querySelectorAll('.tab').forEach(x=>x.classList.remove('active'));
  t.classList.add('active');
  // could toggle contents per tab - for now canvas is shared and info updates
}));

/* ==============
   Angle parsing
   ============== */
function parseInputAngle() {
  const unit = angleUnit.value;
  let v = degInput.value.trim ? degInput.value.trim() : degInput.value;
  if (unit === 'deg') {
    const n = Number(v);
    if (!isFinite(n)) return 0;
    return n;
  } else {
    // rad input; allow "π" or "pi" or "3.14" or "3π/2"
    v = String(v);
    v = v.replace(/\s+/g,'').replace(/PI/ig,'π').replace(/pi/ig,'π');
    try {
      // detect π
      if (v.includes('π')) {
        // examples: π, 2π, π/3, 3π/4
        const parts = v.split('π');
        let coef = parts[0] === '' ? 1 : Number(parts[0]);
        if (!isFinite(coef)) coef = 1;
        let denom = 1;
        if (parts[1] && parts[1].startsWith('/')) {
          denom = Number(parts[1].slice(1));
          if (!isFinite(denom) || denom === 0) denom = 1;
        }
        const rad = coef * Math.PI / denom;
        return rad * 180 / Math.PI;
      } else {
        const rad = Number(v);
        if (!isFinite(rad)) return 0;
        return rad * 180 / Math.PI;
      }
    } catch(e){ return 0; }
  }
}

function angleToRadDeg(angleDeg) {
  const norm = ((angleDeg % 360) + 360) % 360;
  const rad = angleDeg * Math.PI / 180;
  return {deg: angleDeg, norm, rad};
}

/* ==============
   UI updates
   ============== */
function updateFromInputs() {
  const a = parseInputAngle();
  state.angleDeg = a;
  angleRange.value = Math.round(a);
  updateDisplays();
  draw();
}
function updateDisplays() {
  const {deg, norm, rad} = angleToRadDeg(state.angleDeg);
  angleLabel.textContent = `${(+deg).toFixed(3)}°`;
  radLabel.textContent = `(${rad.toFixed(5)} rad)`;
  normDisplay.textContent = `${norm.toFixed(3)}°`;
  // trig values using normalized angle for sin/cos
  const radN = norm * Math.PI / 180;
  const s = Math.sin(radN);
  const c = Math.cos(radN);
  const tan = Math.abs(c) > 1e-12 ? s / c : NaN;
  const cot = Math.abs(s) > 1e-12 ? c / s : NaN;

  sinV.textContent = `sin = ${s.toFixed(6)}`;
  cosV.textContent = `cos = ${c.toFixed(6)}`;
  tanV.textContent = `tan = ${isFinite(tan) ? tan.toFixed(6) : '∞'}`;
  cotV.textContent = `cot = ${isFinite(cot) ? cot.toFixed(6) : '∞'}`;

  // bars map [-1,1] to [0,100%]
  barSin.style.width = `${Math.abs(s) * 100}%`;
  barCos.style.width = `${Math.abs(c) * 100}%`;
  // tan normalized visually, clamp large values
  const tanVis = isFinite(tan) ? Math.min(5, Math.abs(tan)) / 5 : 1;
  barTan.style.width = `${tanVis * 100}%`;

  speedText.textContent = `${state.speed}x`;
  turnsText.textContent = `${Math.floor((state.angleDeg)/360)}`;
}

/* ==================
   Canvas drawing
   ================== */
function clearCanvas() {
  ctx.clearRect(0,0,canvas.width,canvas.height);
}

function draw() {
  clearCanvas();
  const W = canvas.width, H = canvas.height;
  const cx = W * 0.45, cy = H * 0.5;
  const r = Math.min(W, H) * 0.35;

  // background card
  ctx.save();
  ctx.fillStyle = 'rgba(255,255,255,0.9)';
  ctx.fillRect(0,0,W,H);
  ctx.restore();

  // grid / axes
  if (showAxes.checked) {
    ctx.beginPath();
    ctx.moveTo(cx - r - 40, cy);
    ctx.lineTo(cx + r + 40, cy);
    ctx.moveTo(cx, cy - r - 40);
    ctx.lineTo(cx, cy + r + 40);
    ctx.strokeStyle = '#e6ecff';
    ctx.lineWidth = 2;
    ctx.stroke();
    // arrowheads
    drawArrow(cx + r + 40, cy, cx + r + 20, cy - 8);
    drawArrow(cx, cy - r - 40, cx+8, cy - r - 18);
  }

  // circle
  if (showCircle.checked) {
    ctx.beginPath();
    ctx.arc(cx, cy, r, 0, Math.PI*2);
    ctx.strokeStyle = '#dbe7ff';
    ctx.lineWidth = 3;
    ctx.stroke();
  }

  // special points 0,90,180,270
  if (showPoints.checked) {
    const pts = [
      {a:0, label:'A(0°)'},
      {a:90, label:'B(90°)'},
      {a:180, label:'C(180°)'},
      {a:270, label:'D(270°)'}
    ];
    ctx.fillStyle = '#222';
    ctx.font = '12px sans-serif';
    pts.forEach(p=>{
      const rad = p.a * Math.PI / 180;
      const x = cx + r * Math.cos(rad);
      const y = cy - r * Math.sin(rad);
      ctx.beginPath();
      ctx.arc(x,y,5,0,Math.PI*2);
      ctx.fillStyle = '#0b84ff';
      ctx.fill();
      ctx.fillStyle = '#072033';
      ctx.fillText(p.label, x + 8, y + 4);
    });
  }

  // compute angle depending on direction (state.dir)
  let angleDeg = state.angleDeg;
  if (state.dir === 'cw') angleDeg = -angleDeg;

  const normDeg = ((angleDeg % 360) + 360) % 360;
  const rad = angleDeg * Math.PI / 180;
  const x = cx + r * Math.cos(rad);
  const y = cy - r * Math.sin(rad);

  // draw radius OM
  if (showRadius.checked) {
    ctx.beginPath();
    ctx.moveTo(cx, cy);
    ctx.lineTo(x,y);
    ctx.strokeStyle = '#2b63ff';
    ctx.lineWidth = 3;
    ctx.stroke();
    // point M
    ctx.beginPath();
    ctx.arc(x,y,6,0,Math.PI*2);
    ctx.fillStyle = '#ff5c7a';
    ctx.fill();
  }

  // projections for sin/cos
  if (showProjections.checked) {
    ctx.setLineDash([6,6]);
    ctx.beginPath();
    ctx.moveTo(x, cy);
    ctx.lineTo(x,y);
    ctx.strokeStyle = '#ff9f1c';
    ctx.lineWidth = 2;
    ctx.stroke();

    ctx.beginPath();
    ctx.moveTo(cx, y);
    ctx.lineTo(x,y);
    ctx.strokeStyle = '#14b8a6';
    ctx.lineWidth = 2;
    ctx.stroke();
    ctx.setLineDash([]);
  }

  // angle arc near center with label
  const arcR = Math.min(40, r * 0.25);
  ctx.beginPath();
  ctx.arc(cx, cy, arcR, 0, -rad); // draw arc representing angle (negative because canvas y down)
  ctx.strokeStyle = 'rgba(75,93,255,0.9)';
  ctx.lineWidth = 3;
  ctx.stroke();

  // angle text near arc
  ctx.fillStyle = '#14213d';
  ctx.font = '14px sans-serif';
  ctx.fillText(`${(state.angleDeg).toFixed(2)}°`, cx + arcR + 6, cy - 6);

  // small labels for cos and sin numbers at right places
  const cosVal = Math.cos(rad);
  const sinVal = Math.sin(rad);
  ctx.fillStyle = '#0b7a66';
  ctx.fillText(`cos = ${cosVal.toFixed(4)}`, cx + r + 18, cy - 6);
  ctx.fillStyle = '#ff8a42';
  ctx.fillText(`sin = ${sinVal.toFixed(4)}`, cx + r + 18, cy + 14);

  // optional: draw unit arrow on circle to show motion
  ctx.beginPath();
  ctx.moveTo(cx + r * Math.cos(rad) * 0.96, cy - r * Math.sin(rad) * 0.96);
  ctx.lineTo(cx + r * Math.cos(rad) * 1.06, cy - r * Math.sin(rad) * 1.06);
  ctx.strokeStyle = '#111827';
  ctx.lineWidth = 1;
  ctx.stroke();

  // small center
  ctx.beginPath();
  ctx.arc(cx, cy, 3, 0, Math.PI*2);
  ctx.fillStyle = '#0b1b2b';
  ctx.fill();

  // debug: show ticks at multiples of 30/45 degrees
  ctx.fillStyle = '#6b7280';
  ctx.font = '12px sans-serif';
  for (let a=0;a<360;a+=30){
    const radTick = a * Math.PI / 180;
    const tx = cx + (r+12) * Math.cos(radTick);
    const ty = cy - (r+12) * Math.sin(radTick);
    ctx.fillText(`${a}°`, tx-8, ty+4);
  }
}

/* draw arrow helper */
function drawArrow(x1,y1,x2,y2){
  ctx.beginPath();
  ctx.moveTo(x1,y1);
  ctx.lineTo(x2,y2);
  ctx.stroke();
  // head
  ctx.beginPath();
  ctx.moveTo(x1,y1);
  ctx.lineTo(x1-8, y1-6);
  ctx.lineTo(x1-8, y1+6);
  ctx.closePath();
  ctx.fillStyle = '#e6eefc';
  ctx.fill();
}

/* =====================
   Animation & tick
   ===================== */
function tick(now){
  const dt = (now - state.lastTime) / 1000;
  state.lastTime = now;
  state.frameCount++;
  // fps estimate
  if (state.frameCount % 10 === 0) {
    state.fps = Math.round(1 / Math.max(1e-6, (dt)));
    fpsLabel.textContent = state.fps;
  }

  if (state.anim) {
    // advance angle by speed * baseRate * dt
    const baseRate = 90; // degrees per second at 1x
    const dir = state.dir === 'ccw' ? 1 : -1;
    state.angleDeg += dir * baseRate * state.speed * dt;
    // keep range with many turns allowed
    // update slider and inputs
    angleRange.value = Math.round(state.angleDeg);
    // when angle crosses 360, increment loops (informational)
    // update input box if unit = deg
    if (angleUnit.value === 'deg') {
      degInput.value = state.angleDeg.toFixed(3);
    } else {
      // rad mode: display rad fraction maybe skip auto update
      degInput.value = (state.angleDeg * Math.PI/180).toFixed(5);
    }
    updateDisplays();
    draw();
  }

  requestAnimationFrame(tick);
}

/* =====================
   Event listeners
   ===================== */
degInput.addEventListener('input', ()=>{
  // user changed numeric input
  if (angleUnit.value === 'deg') {
    state.angleDeg = Number(degInput.value);
  } else {
    // input is rad (entered in degInput), convert: displayed rad -> deg
    const val = Number(degInput.value);
    if (isFinite(val)) state.angleDeg = val * 180 / Math.PI;
  }
  angleRange.value = Math.round(state.angleDeg);
  updateDisplays();
  draw();
});

angleUnit.addEventListener('change', ()=>{
  // convert degInput display to appropriate unit
  if (angleUnit.value === 'deg') {
    // currently degInput holds rad; convert rad->deg and show degrees
    const cur = Number(degInput.value);
    if (isFinite(cur)) {
      degInput.value = (cur * 180 / Math.PI).toFixed(5);
    }
  } else {
    // currently holds deg; convert deg->rad
    const cur = Number(degInput.value);
    if (isFinite(cur)) {
      degInput.value = (cur * Math.PI / 180).toFixed(5);
    }
  }
});

angleRange.addEventListener('input', ()=>{
  const v = Number(angleRange.value);
  state.angleDeg = v;
  if (angleUnit.value === 'deg') degInput.value = state.angleDeg.toFixed(3);
  else degInput.value = (state.angleDeg * Math.PI / 180).toFixed(5);
  updateDisplays();
  draw();
});

playBtn.addEventListener('click', ()=>{
  state.anim = true;
  state.lastTime = performance.now();
});

pauseBtn.addEventListener('click', ()=>{
  state.anim = false;
});

zeroBtn.addEventListener('click', ()=>{
  state.angleDeg = 0;
  angleRange.value = 0;
  if (angleUnit.value === 'deg') degInput.value = '0';
  else degInput.value = '0';
  updateDisplays();
  draw();
});

speedSel.addEventListener('change', ()=>{
  state.speed = Number(speedSel.value);
  speedText.textContent = `${state.speed}x`;
});

dirSel.addEventListener('change', ()=>{
  state.dir = dirSel.value;
});

piSample.addEventListener('click', ()=>{
  // set rad input example and switch unit to rad
  angleUnit.value = 'rad';
  degInput.value = 'π/3';
  // parse and update
  // simulate user entering π/3 -> our parseInputAngle expects string, but degInput is number input type, so we temporarily set it via text.
  // handle by switching to text input? easier: set to numeric rad value
  const radVal = Math.PI/3;
  degInput.value = radVal.toFixed(6);
  // update internal angle
  state.angleDeg = radVal * 180 / Math.PI;
  angleRange.value = Math.round(state.angleDeg);
  updateDisplays();
  draw();
});

/* checkboxes: just redraw on change */
[showAxes, showCircle, showRadius, showProjections, showPoints].forEach(ch=>{
  ch.addEventListener('change', draw);
});

/* init */
updateFromInputs();
state.lastTime = performance.now();
requestAnimationFrame(tick);

/* ensure canvas resizes for device pixel ratio */
function resizeCanvasToDisplaySize() {
  const ratio = window.devicePixelRatio || 1;
  const rect = canvas.getBoundingClientRect();
  const w = Math.round(rect.width * ratio);
  const h = Math.round(rect.height * ratio);
  if (canvas.width !== w || canvas.height !== h) {
    canvas.width = w;
    canvas.height = h;
    canvas.style.width = rect.width + 'px';
    canvas.style.height = rect.height + 'px';
  }
}
window.addEventListener('resize', ()=>{
  // limit to reasonable
  canvas.width = Math.min(1200, window.innerWidth * 0.6);
  canvas.height = Math.min(800, Math.max(420, window.innerHeight * 0.6));
  draw();
});
(function initialCanvasSize(){
  // set a default size responsive
  const ww = Math.min(900, window.innerWidth - 420);
  canvas.width = Math.max(600, ww);
  canvas.height = Math.max(420, Math.round(canvas.width * 0.75));
  draw();
})();

</script>
</body>
</html>
